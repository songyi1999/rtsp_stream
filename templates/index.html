<!DOCTYPE html>
<html>
<head>
    <title>RTSP Stream Player</title>
    <style>
        #canvas {
            width: 800px;
            height: 600px;
        }
    </style>
</head>
<body>
    <div>
        <input type="text" id="rtspUrl" placeholder="输入RTSP地址" style="width: 300px;">
        <button onclick="startStream()">开始播放</button>
        <button onclick="stopStream()">停止播放</button>
    </div>
    <canvas id="canvas"></canvas>
    
    <script type="text/javascript" src="/static/jsmpeg.min.js"></script>
    <script type="text/javascript">
        let player = null;
        const wsPort = 9999;

        async function startStream() {
            const rtspUrl = document.getElementById('rtspUrl').value;
            
            // 调用后端接口启动流
            const response = await fetch('/stream/start', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    rtsp_url: rtspUrl,
                    ws_port: wsPort
                })
            });
            
            const data = await response.json();
            if (data.status === 'success') {
                // 连接WebSocket流
                player = new JSMpeg.Player(data.ws_url, {
                    canvas: document.getElementById('canvas')
                });
            } else {
                alert('启动失败: ' + data.error);
            }
        }

        async function stopStream() {
            if (player) {
                // 调用后端接口停止流
                await fetch('/stream/stop', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ws_port: wsPort
                    })
                });
                
                player.destroy();
                player = null;
            }
        }
    </script>
</body>
</html> 